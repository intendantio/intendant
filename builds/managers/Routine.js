"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Routine=_interopRequireDefault(require("../instances/Routine")),_package=_interopRequireDefault(require("../package")),_connector=_interopRequireDefault(require("../connector")),_Tracing=_interopRequireDefault(require("../utils/Tracing"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class RoutineCore{constructor(a){this.core=a,this.configuration=this.core.configuration,this.routines=new Map,_Tracing.default.verbose(_package.default.name,"Routine manager : start"),this.initialisation()}async initialisation(){try{let a=new _connector.default("routine"),b=await a.getAll();if(b.error)return void _Tracing.default.warning(_package.default.name,b.message);let c=b.data;c.forEach(async a=>{let b=this.routines.has(a.id);if(0===a.status&&b)_Tracing.default.verbose(_package.default.name,"Routine manager : disable routine n\xB0"+a.id),this.routines.get(a.id).close(),this.routines.delete(a.id);else if(1===a.status&&!1===b){_Tracing.default.verbose(_package.default.name,"Routine manager : enable routine n\xB0"+a.id);let b=await this.core.controller.routine.getOne(a.id);a=b.data,this.routines.set(a.id,new _Routine.default(a,this.core))}})}catch(a){return _Tracing.default.error("Routine manager : "+a.toString()),{package:_package.default.name,error:!0,message:"Internal server error"}}}}var _default=RoutineCore;exports.default=_default,module.exports=exports.default;