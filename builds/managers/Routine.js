"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Routine=_interopRequireDefault(require("../instances/Routine")),_package=_interopRequireDefault(require("../package")),_connector=_interopRequireDefault(require("../connector")),_Tracing=_interopRequireDefault(require("../utils/Tracing")),_Result=_interopRequireDefault(require("../utils/Result")),_StackTrace=_interopRequireDefault(require("../utils/StackTrace")),_Manager=_interopRequireDefault(require("./Manager"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Routine extends _Manager.default{constructor(a){super(),this.core=a,this._instances=new Map,_Tracing.default.verbose(_package.default.name,"Routine manager : start"),this.initialisation()}async initialisation(){try{let a=new _connector.default("routine"),b=await a.getAll();if(b.error)return void _Tracing.default.warning(_package.default.name,b.message);let c=b.data;c.forEach(async a=>{let b=this._instances.has(a.id);if(0===a.status&&b)_Tracing.default.verbose(_package.default.name,"Routine n\xB0"+a.id+" stop"),this._instances.get(a.id).close(),this._instances.delete(a.id);else if(1===a.status&&!1===b){_Tracing.default.verbose(_package.default.name,"Routine n\xB0"+a.id+" start");let b=await this.core.controller.routine.getOne(a.id);a=b.data,this._instances.set(a.id,new _Routine.default(a,this.core))}})}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when get token"),new _Result.default(_package.default.name,!0,"Error occurred when routine initialisation")}}}var _default=Routine;exports.default=_default,module.exports=exports.default;