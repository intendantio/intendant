"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _package=_interopRequireDefault(require("../package")),_Tracing=_interopRequireDefault(require("../utils/Tracing")),_StackTrace=_interopRequireDefault(require("../utils/StackTrace")),_Result=_interopRequireDefault(require("../utils/Result")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_fs=_interopRequireDefault(require("fs")),_Manager=_interopRequireDefault(require("./Manager"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Module extends _Manager.default{constructor(a){/* Private */super(),this.core=a,this.packages=[],this.instances=new Map}async before(){try{_Tracing.default.verbose(_package.default.name,"Start module manager");let a=await(0,_nodeFetch.default)("https://market.intendant.io/modules"),b=await a.json();return b.filter(a=>_fs.default.existsSync("./node_modules/"+a.name)).forEach(a=>{this.packages.push(a.name)}),this.restart()}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when executing before function"),new _Result.default(_package.default.name,!0,"Error occurred when executing before function")}}restart(){try{this.instances=new Map;for(let a=0;a<this.packages.length;a++)try{let b=this.packages[a],c=require(b),d=new c(this.core,_Tracing.default);this.instances.set(b,d),_Tracing.default.verbose(_package.default.name,"Instanciate "+b)}catch(a){_StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when instanciate "+pPackage),this.packages=this.packages.filter(a=>a!=pPackage)}return new _Result.default(_package.default.name,!1,"")}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when restart module manager"),new _Result.default(_package.default.name,!0,"Error occurred when restart module manager")}}getAll(){try{let a=[];for(let b=0;b<this.packages.length;b++){let c=this.packages[b],d=require(c+"/package.json");a.push(d)}return new _Result.default(_package.default.name,!1,"",a)}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when get all configuration in module manager"),new _Result.default(_package.default.name,!0,"Error occurred when get all configuration in module manage")}}}var _default=Module;exports.default=_default,module.exports=exports.default;