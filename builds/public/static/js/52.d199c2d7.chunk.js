"use strict";(self.webpackChunk_intendant_dashboard=self.webpackChunk_intendant_dashboard||[]).push([[52],{3052:function(t,e,n){n.r(e),n.d(e,{default:function(){return F}});var i=n(3032),s=n(7853),r=n(4531),o=n(8932),a=n(2587),c=n(4322),u=n.n(c),d=n(2791),l=(n(4893),n(722)),p=n(5886),g=n(184),h=n(703),f=n(890),m=n(8102),Z=n(5818),x=n(4554),v=n(4721),w=n(3721),y=n(1889),j=n(7355),S=n(7621),b=n(6647),C=n(9504),k=n(6125),M=n(2363),A=n(3400),E=n(8087),N=n(6565),R=function(t){(0,o.Z)(n,t);var e=(0,a.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).state={configuration:i.props.configuration,widget:i.props.widget,loading:!1},i}return(0,r.Z)(n,[{key:"render",value:function(){var t=this;return this.state.loading?(0,g.jsx)(N.Z,{}):(0,g.jsx)(y.ZP,{item:!0,xs:12,md:6,lg:4,children:(0,g.jsxs)(S.Z,{variant:"outlined",children:[(0,g.jsx)(b.Z,{onClick:function(){t.props.onSelect()},children:(0,g.jsxs)(C.Z,{children:[this.state.widget.contents.filter((function(t){return"title"==t.type})).map((function(t,e){return(0,g.jsx)(f.Z,{variant:"subtitle1",component:"div",children:t.example},e)})),this.state.widget.contents.filter((function(t){return"text"==t.type})).length>0&&(0,g.jsx)(v.Z,{style:{marginBottom:10,marginTop:5}}),this.state.widget.contents.filter((function(t){return"text"==t.type})).map((function(e,n){return(0,g.jsx)(f.Z,{variant:"body2",color:e.style&&e.style.color?t.state.widget.dataSources[e.style.color]:"text.secondary",children:e.example},n)}))]})}),(0,g.jsxs)(k.Z,{in:this.props.open,timeout:"auto",unmountOnExit:!0,children:[(0,g.jsx)(v.Z,{}),this.props.settings.length>0&&(0,g.jsx)(C.Z,{style:{padding:10},children:(0,g.jsx)(y.ZP,{container:!0,spacing:1,children:this.props.settings.map((function(e,n){return(0,g.jsx)(l.Z,{xs:12,md:12,lg:12,id:"widget-"+e.id,options:e.options,label:String.capitalizeFirstLetter(e.id.split("_")[0]),setState:t.props.setState,action:e},"widget-"+e.id)}))})}),(0,g.jsx)(M.Z,{children:(0,g.jsx)(A.Z,{onClick:function(){t.props.onSubmit((function(){t.setState({loading:!1})})),t.setState({loading:!0})},children:(0,g.jsx)(E.Z,{})})})]})]})},this.props.index)}}]),n}(d.Component),B=n(9388),P=n(419),_=n(7457),z=function(t){(0,o.Z)(n,t);var e=(0,a.Z)(n);function n(t){var i;return(0,s.Z)(this,n),(i=e.call(this,t)).state={loading:!0,index:-1,open:!1,widget:{settings:[]},configuration:{module:"module"},configurations:[],settings:[]},t.setTitle("New widget"),t.setActionType("return"),i}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){var t=(0,i.Z)(u().mark((function t(){var e,n,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new p.Z).get().fetch("/api/modules");case 2:return e=t.sent,t.next=5,(new p.Z).get().fetch("/api/smartobjects");case 5:(n=t.sent).error?(this.props.setMessage(n.package+" : "+n.message),this.props.history.push("/widget")):e.error?(this.props.setMessage(e.package+" : "+e.message),this.props.history.push("/widget")):(i=[],n.data.forEach((function(t){Array.isArray(t.widgets)&&t.widgets.length>0&&i.push(t)})),e.data.forEach((function(t){Array.isArray(t.widgets)&&t.widgets.length>0&&i.push({configuration:t,name:t.name,reference:t.reference,widgets:t.widgets,dataSources:t.dataSources,actions:t.actions})})),0==i.length?(this.props.setMessage("No widget available"),this.props.history.push("/widget")):this.setState({loading:!1,configurations:i}));case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"submit",value:function(){var t=(0,i.Z)(u().mark((function t(e){var n,i,s,r,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=[],i={},s=0;s<this.state.settings.length;s++)r=this.state.settings[s],i["widget-"+r.id]=null,n.push({reference:r.id,value:this.state["widget-"+r.id]?this.state["widget-"+r.id]:null,type:typeof this.state["widget-"+r.id]});return t.next=5,(new p.Z).post({reference:this.state.widget.id,type:this.state.configuration.configuration.module,object:"smartobject"==this.state.configuration.configuration.module?this.state.configuration.id:_.Z.getSum(this.state.configuration.name),settings:n}).fetch("/api/widgets");case 5:(o=t.sent).error?(e(),this.props.setMessage(o.package+" : "+o.message)):(this.setState(i),document.getElementById("main").scroll({top:0,left:0}),this.props.history.push("/widget"));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"delete",value:function(t){var e=[];this.state.contents.forEach((function(n,i){i!=t&&e.push(n)})),this.setState({contents:e})}},{key:"selectWidget",value:function(t,e){var n=this;if((!this.state.open||"smartobject"!=t.module||"smartobject"!=this.state.configuration.module||this.state.configuration.smartobject.id!=t.smartobject.id)&&(!this.state.open||e.name!=this.state.widget.name||"module"!=t.module||"module"!=this.state.configuration.module)){this.setState({open:!1});var i=[],s=[];if(Array.isArray(t.dataSources)){var r=[];t.dataSources.forEach((function(t){e.dataSources.includes(t.id)&&0==r.includes(t.action)&&r.push(t.action)})),t.actions.forEach((function(t){r.includes(t.id)&&t.settings.forEach((function(t){0==s.includes(t.id)&&(i.push(t),s.push(t.id))}))}))}this.setState({widget:e,settings:i,configuration:t},(function(){n.setState({open:!0})}))}}},{key:"render",value:function(){var t=this;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(P.Z,{isMobile:this.props.isMobile,children:(0,g.jsxs)(h.Z,{variant:"outlined",style:{padding:12,marginBottom:10,justifyContent:"left"},children:[(0,g.jsx)(f.Z,{variant:"h6",fontWeight:"bold",children:"Widget"}),(0,g.jsx)(f.Z,{variant:"subtitle2",color:"text.secondary",children:"Show what you need"})]})}),(0,g.jsx)(B.Z,{loading:this.state.loading,children:this.state.configurations.map((function(e,n){return(0,g.jsxs)(m.Z,{style:{marginBottom:10,borderRadius:5},variant:"outlined",expanded:t.state.index==n,onChange:function(){t.setState({index:t.state.index==n?-1:n})},children:[(0,g.jsx)(Z.Z,{expandIcon:(0,g.jsx)(j.Z,{}),children:(0,g.jsxs)(x.Z,{children:[(0,g.jsx)(f.Z,{variant:"subtitle1",children:String.capitalizeFirstLetter(e.reference)}),e.room&&(0,g.jsx)(f.Z,{variant:"body2",color:"text.secondary",children:String.capitalizeFirstLetter(e.room.name)})]})}),(0,g.jsx)(v.Z,{style:{marginBottom:15}}),(0,g.jsx)(w.Z,{children:(0,g.jsx)(y.ZP,{container:!0,spacing:1,children:e.widgets.map((function(n,i){return(0,g.jsx)(R,{index:i,open:t.state.open&&t.state.widget.id==n.id&&t.state.configuration.id==e.id,onSelect:function(){t.selectWidget(e,n)},onClose:function(){t.setState({open:!1})},onSubmit:function(e){t.submit(e)},setState:t.setState.bind(t),widget:n,settings:t.state.settings,configuration:e})}))})})]})}))})]})}}]),n}(d.Component),F=z},7457:function(t,e,n){var i=n(7853),s=n(4531),r=function(){function t(){(0,i.Z)(this,t)}return(0,s.Z)(t,null,[{key:"getSum",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t.split("").reduce((function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t}),0)}}]),t}();e.Z=r},7355:function(t,e,n){var i=n(4223),s=n(184);e.Z=(0,i.Z)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore")},2363:function(t,e,n){n.d(e,{Z:function(){return f}});var i=n(3366),s=n(7462),r=n(2791),o=n(8182),a=n(767),c=n(7630),u=n(1046),d=n(5159);function l(t){return(0,d.Z)("MuiCardActions",t)}(0,n(208).Z)("MuiCardActions",["root","spacing"]);var p=n(184),g=["disableSpacing","className"],h=(0,c.ZP)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:function(t,e){var n=t.ownerState;return[e.root,!n.disableSpacing&&e.spacing]}})((function(t){var e=t.ownerState;return(0,s.Z)({display:"flex",alignItems:"center",padding:8},!e.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})})),f=r.forwardRef((function(t,e){var n=(0,u.Z)({props:t,name:"MuiCardActions"}),r=n.disableSpacing,c=void 0!==r&&r,d=n.className,f=(0,i.Z)(n,g),m=(0,s.Z)({},n,{disableSpacing:c}),Z=function(t){var e=t.classes,n={root:["root",!t.disableSpacing&&"spacing"]};return(0,a.Z)(n,l,e)}(m);return(0,p.jsx)(h,(0,s.Z)({className:(0,o.Z)(Z.root,d),ownerState:m,ref:e},f))}))},9504:function(t,e,n){n.d(e,{Z:function(){return f}});var i=n(7462),s=n(3366),r=n(2791),o=n(8182),a=n(767),c=n(7630),u=n(1046),d=n(5159);function l(t){return(0,d.Z)("MuiCardContent",t)}(0,n(208).Z)("MuiCardContent",["root"]);var p=n(184),g=["className","component"],h=(0,c.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:function(t,e){return e.root}})((function(){return{padding:16,"&:last-child":{paddingBottom:24}}})),f=r.forwardRef((function(t,e){var n=(0,u.Z)({props:t,name:"MuiCardContent"}),r=n.className,c=n.component,d=void 0===c?"div":c,f=(0,s.Z)(n,g),m=(0,i.Z)({},n,{component:d}),Z=function(t){var e=t.classes;return(0,a.Z)({root:["root"]},l,e)}(m);return(0,p.jsx)(h,(0,i.Z)({as:d,className:(0,o.Z)(Z.root,r),ownerState:m,ref:e},f))}))}}]);
//# sourceMappingURL=52.d199c2d7.chunk.js.map