"use strict";(self.webpackChunk_intendant_dashboard=self.webpackChunk_intendant_dashboard||[]).push([[237],{3152:function(t,e,i){function n(t){return t.index==t.value?t.children:null}i.d(e,{Z:function(){return n}})},6237:function(t,e,i){i.r(e);var n=i(8489),s=i(3032),r=i(7853),a=i(4531),c=i(8932),o=i(2587),d=i(4322),l=i.n(d),p=i(2791),h=i(703),u=i(890),g=i(7621),f=i(242),x=i(4512),m=i(5825),Z=i(1889),j=i(6647),y=i(7391),v=i(5886),b=i(419),w=i(9388),k=i(722),S=(i(6711),i(3152)),C=i(6067),P=i(184),T=function(t){(0,c.Z)(i,t);var e=(0,o.Z)(i);function i(t){var n;return(0,r.Z)(this,i),(n=e.call(this,t)).state={loading:!0,processes:[],sources:[],selected:null,trigger:null,triggers:[],step:"trigger",description:""},t.setTitle("New automation"),t.setActionType("return"),n}return(0,a.Z)(i,[{key:"componentDidMount",value:function(){var t=(0,s.Z)(l().mark((function t(){var e,i,n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new v.Z).get().fetch("/api/smartobjects");case 2:return e=t.sent,t.next=5,(new v.Z).get().fetch("/api/processes");case 5:i=t.sent,e.error?(this.props.setMessage(e.package+" : "+e.message),this.props.history.push("/automation")):i.error?(this.props.setMessage(i.package+" : "+i.message),this.props.history.push("/automation")):(n=[],e.data.filter((function(t){return null!=t.configuration})).filter((function(t){return null!=t.configuration.triggers})).forEach((function(t){t.type="smartobject",n.push(t)})),i.data.forEach((function(t){t.type="process",t.reference=t.description,t.triggers=[],t.actions=[{id:"process",name:"switch"==t.mode?t.description_on+"/"+t.description_off:t.description_on,description:"switch"==t.mode?t.description_on+"/"+t.description_off:t.description_on,type:"effect",settings:t.inputs.map((function(t){return t.id=t.reference,t}))}],n.push(t)})),this.setState({loading:!1,sources:n}));case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"submit",value:function(){var t=(0,s.Z)(l().mark((function t(){var e,i,n,s,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=[],i=0;i<this.state.action.settings.length;i++)n=this.state.action.settings[i],e.push({reference:n.id,value:this.state[this.state.action.id+"-"+n.id]?this.state[this.state.action.id+"-"+n.id]:null});return s={description:this.state.description,trigger:{type:this.state.trigger.parentType,object:this.state.trigger.parent,trigger:this.state.trigger.id},action:{type:this.state.action.parentType,object:this.state.action.parent,action:this.state.action.id,settings:e}},t.next=5,(new v.Z).post(s).fetch("/api/automations");case 5:(r=t.sent).error?this.props.setMessage(r.package+" : "+r.message):this.props.history.push("/automation");case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(b.Z,(0,n.Z)((0,n.Z)({},this.props),{},{children:(0,P.jsxs)(h.Z,{variant:"outlined",style:{padding:12,justifyContent:"left"},children:[(0,P.jsx)(u.Z,{variant:"h6",fontWeight:"bold",children:"New automation"}),(0,P.jsx)(u.Z,{variant:"subtitle2",color:"text.secondary",children:"Do what you want when you want"})]})})),(0,P.jsxs)(w.Z,{loading:this.state.loading,children:[(0,P.jsx)(g.Z,{variant:"outlined",style:{padding:10,marginTop:8},children:(0,P.jsxs)(f.Z,{activeStep:{trigger:0,action:1,description:2}[this.state.step],children:[(0,P.jsx)(x.Z,{children:(0,P.jsx)(m.Z,{children:"Trigger"})},"trigger"),(0,P.jsx)(x.Z,{children:(0,P.jsx)(m.Z,{children:"Action"})},"action"),(0,P.jsx)(x.Z,{children:(0,P.jsx)(m.Z,{children:"Description"})},"description")]})}),(0,P.jsxs)(Z.ZP,{container:!0,spacing:1,style:{marginTop:0},children:[(0,P.jsx)(S.Z,{index:"trigger",value:this.state.step,children:this.state.selected?this.state.selected.triggers.map((function(e,i){return e.parent=t.state.selected.id,e.parentType=t.state.selected.type,(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,P.jsx)(g.Z,{variant:"outlined",children:(0,P.jsx)(j.Z,{onClick:function(){t.setState({step:"action",trigger:e,selected:null,description:"IF "+e.name.toLowerCase()+" THEN "})},style:{padding:10},children:(0,P.jsx)(u.Z,{variant:"subtitle1",children:String.capitalizeFirstLetter(e.name)})})})},i)})):this.state.sources.map((function(e,i){if(e.triggers.length>0)return(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,P.jsx)(g.Z,{variant:"outlined",children:(0,P.jsxs)(j.Z,{onClick:function(){t.setState({selected:e})},style:{padding:10},children:[(0,P.jsx)(u.Z,{variant:"subtitle1",children:String.capitalizeFirstLetter(e.reference)}),e.room&&(0,P.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String.capitalizeFirstLetter(e.room.name)})]})})},i)}))}),(0,P.jsx)(S.Z,{index:"action",value:this.state.step,children:this.state.selected?this.state.selected.actions.filter((function(t){return"effect"==t.type})).map((function(e,i){return e.parent=t.state.selected.id,e.parentType=t.state.selected.type,(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,P.jsx)(g.Z,{variant:"outlined",style:{padding:10},children:(0,P.jsxs)(Z.ZP,{container:!0,spacing:1,children:[(0,P.jsx)(Z.ZP,{item:!0,xs:6,md:11,lg:11,style:{alignSelf:"center"},children:(0,P.jsx)(u.Z,{variant:"subtitle1",children:e.name})}),(0,P.jsx)(C.Z,{xs:6,md:1,lg:1,onClick:function(){t.setState({step:"description",action:e,selected:null,description:t.state.description+e.name.toLowerCase()})}}),e.settings.map((function(i,n){return(0,P.jsx)(k.Z,{options:i.options,label:String.capitalizeFirstLetter(i.id),setState:t.setState.bind(t),id:e.id+"-"+i.id,action:i},n)}))]})})},i)})):(0,P.jsx)(P.Fragment,{children:this.state.sources.map((function(e,i){var n=!1;if(e.actions.forEach((function(t){"effect"==t.type&&(n=!0)})),n)return(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,P.jsx)(g.Z,{variant:"outlined",children:(0,P.jsxs)(j.Z,{onClick:function(){t.setState({selected:e})},style:{padding:10},children:[(0,P.jsx)(u.Z,{variant:"subtitle1",children:String.capitalizeFirstLetter(e.reference)}),e.room&&(0,P.jsx)(u.Z,{variant:"body2",color:"text.secondary",children:String.capitalizeFirstLetter(e.room.name)})]})})},i)}))})}),(0,P.jsx)(S.Z,{index:"description",value:this.state.step,children:(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,P.jsx)(g.Z,{variant:"outlined",style:{padding:10,display:"flex",alignItems:"center"},children:(0,P.jsxs)(Z.ZP,{container:!0,spacing:1,children:[(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:10,lg:10,children:(0,P.jsx)(y.Z,{value:this.state.description,onChange:function(e){t.setState({description:e.nativeEvent.target.value})},placeholder:"Description",style:{width:"100%"}})}),(0,P.jsx)(Z.ZP,{item:!0,xs:12,md:2,lg:2,style:{display:"flex",justifyContent:"end"},children:(0,P.jsx)(g.Z,{variant:"outlined",style:{height:"100%",width:"min-content"},children:(0,P.jsx)(j.Z,{onClick:function(){t.submit()},style:{padding:8,paddingLeft:16,paddingRight:16,display:"flex",height:"100%"},children:(0,P.jsx)(u.Z,{variant:"subtitle1",children:"Submit"})})})})]})})})})]})]})]})}}]),i}(p.Component);e.default=T}}]);
//# sourceMappingURL=237.9f9a28ab.chunk.js.map