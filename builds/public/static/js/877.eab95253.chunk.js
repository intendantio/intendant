"use strict";(self.webpackChunk_intendant_dashboard=self.webpackChunk_intendant_dashboard||[]).push([[877],{7877:function(t,e,n){n.r(e);var s=n(8489),i=n(3032),r=n(7853),a=n(4531),o=n(8932),c=n(2587),l=n(4322),d=n.n(l),h=n(2791),p=n(9779),u=n.n(p),x=n(703),m=n(4554),g=n(890),f=n(1889),j=n(7621),Z=n(9373),v=n(8102),y=n(5818),b=n(4721),w=n(3721),k=n(7391),S=n(4807),P=n(7067),C=n(7355),M=n(6080),A=n(8187),R=n(3530),T=(n(4893),n(722)),z=n(419),L=n(5886),D=n(9388),F=n(4051),B=n(7610),I=n(184),O=function(t){(0,o.Z)(n,t);var e=(0,c.Z)(n);function n(t){var s;return(0,r.Z)(this,n),(s=e.call(this,t)).state={id:t.match.params.idSmartobject,idRoom:t.match.params.id,smartobject:{reference:"",actions:[],room:{},state:{status:"unknown"}},expanded:"action",rooms:[],modalOpen:!1,content:{},loadingAction:"",loading:!0},t.setTitle(""),t.setActionType("return"),s}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){var t=(0,i.Z)(d().mark((function t(){var e,n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new L.Z).get().fetch("/api/rooms");case 2:return e=t.sent,t.next=5,(new L.Z).get().fetch("/api/smartobjects/"+this.state.id);case 5:n=t.sent,e.error?(this.props.setMessage(e.package+" : "+e.message),this.props.history.push("/room/"+this.state.idRoom)):n.error?(this.props.setMessage(n.package+" : "+n.message),this.props.history.push("/room/"+this.state.idRoom)):(this.props.setTitle(n.data.reference),this.setState({reference:n.data.reference,loadingAction:"",loading:!1,smartobject:n.data,rooms:e.data}));case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"delete",value:function(){var t=(0,i.Z)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new L.Z).delete().fetch("/api/smartobjects/"+this.state.id);case 2:(e=t.sent).error?this.props.setMessage(e.package+" : "+e.message):this.props.history.push("/room/"+this.state.idRoom);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"executeAction",value:function(){var t=(0,i.Z)(d().mark((function t(e,n){var s,i,r,a,o;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.setState({loadingAction:e.id}),s={},i=0;i<n.length;i++)r=n[i],a=this.state[e.id+"-"+r.id],s[r.id]=a||r.default;return t.next=5,(new L.Z).post({settings:s}).fetch("/api/smartobjects/"+this.state.id+"/actions/"+e.id);case 5:(o=t.sent).error?(this.props.setMessage(o.package+" : "+o.message),this.setState({loadingAction:""})):(this.setState({modalOpen:!0,content:o.data}),this.componentDidMount());case 7:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"updateRoom",value:function(){var t=(0,i.Z)(d().mark((function t(e){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new L.Z).post({idRoom:e.id}).fetch("/api/smartobjects/"+this.state.smartobject.id+"/room");case 2:(n=t.sent).error?this.props.setMessage(n.package+" : "+n.message):this.componentDidMount();case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"updateReference",value:function(){var t=(0,i.Z)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new L.Z).post({reference:this.state.reference}).fetch("/api/smartobjects/"+this.state.smartobject.id+"/reference");case 2:(e=t.sent).error?this.props.setMessage(e.package+" : "+e.message):this.componentDidMount();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"installPackage",value:function(){var t=(0,i.Z)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({loading:!0}),t.next=3,(new L.Z).patch({package:this.state.smartobject.module}).fetch("/api/smartobjects");case 3:(e=t.sent).error?(this.props.setMessage(e.package+" : "+e.message),this.props.history.push("/room/"+this.state.idRoom)):this.componentDidMount();case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e="";return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(z.Z,(0,s.Z)((0,s.Z)({},this.props),{},{children:(0,I.jsx)(x.Z,{variant:"outlined",style:{padding:12,justifyContent:"left"},children:(0,I.jsx)(m.Z,{style:{display:"flex",flex:1},children:(0,I.jsxs)(m.Z,{style:{flex:4,alignSelf:"center",alignItems:"center"},children:[(0,I.jsx)(g.Z,{variant:"h6",fontWeight:"bold",children:String.capitalizeFirstLetter(this.state.smartobject.reference)}),(0,I.jsx)(g.Z,{variant:"subtitle2",color:"text.secondary",children:String.capitalizeFirstLetter(this.state.smartobject.module)})]})})})})),(0,I.jsxs)(D.Z,{loading:this.state.loading,children:[(0,I.jsxs)(f.ZP,{container:!0,spacing:1,style:{marginTop:0},children:["uninstalled"==this.state.smartobject.state.status?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(f.ZP,{item:!0,xs:12,md:6,lg:10,children:(0,I.jsx)(j.Z,{variant:"outlined",style:{padding:12},children:(0,I.jsxs)(m.Z,{style:{display:"flex",flexDirection:"row"},children:[(0,I.jsx)(P.Z,{style:{fontSize:"24px"}}),(0,I.jsx)(g.Z,{variant:"subtitle1",style:{marginLeft:12},children:"Smartobject is not correctly installed"})]})})}),(0,I.jsx)(f.ZP,{item:!0,xs:12,md:6,lg:2,children:(0,I.jsx)(j.Z,{style:{height:"100%"},variant:"outlined",children:(0,I.jsx)(Z.Z,{onClick:function(){t.installPackage()},style:{padding:10,height:"100%",width:"100%"},variant:"contained",size:"small",color:"error",children:(0,I.jsx)(g.Z,{variant:"subtitle1",style:{textAlign:"center",color:"white",textTransform:"none"},children:"Fix smartobject"})})})})]}):null,(0,I.jsx)(f.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,I.jsxs)(v.Z,{variant:"outlined",expanded:"action"===this.state.expanded,onChange:function(){return t.setState({expanded:"action"})},children:[(0,I.jsxs)(y.Z,{expandIcon:(0,I.jsx)(C.Z,{}),children:[(0,I.jsx)(M.Z,{style:{fontSize:"28px"}}),(0,I.jsx)(g.Z,{variant:"h6",style:{marginLeft:5},children:"Action"})]}),(0,I.jsx)(b.Z,{}),(0,I.jsx)(w.Z,{children:(0,I.jsx)(f.ZP,{container:!0,children:this.state.smartobject.actions.map((function(n,s){if("trigger"==n.type)return null;var i=n.group&&n.group!=e;return e=n.group?n.group:"",(0,I.jsxs)(f.ZP,{item:!0,xs:12,md:12,lg:12,style:{marginTop:7},children:[i&&(0,I.jsx)(b.Z,{style:{marginBottom:14},children:(0,I.jsx)(g.Z,{textAlign:"center",variant:"subtitle1",children:e})}),(0,I.jsxs)(f.ZP,{container:!0,spacing:0==n.settings.length&&t.props.isMobile?0:2,children:[(0,I.jsx)(f.ZP,{item:!0,xs:12,md:3,lg:3,children:(0,I.jsx)(j.Z,{elevation:2,children:(0,I.jsx)(Z.Z,{disabled:n.id==t.state.loadingAction||"online"!=t.state.smartobject.state.status,variant:"contained",onClick:function(){t.executeAction(n,n.settings)},style:{width:"100%",flexDirection:"row",display:"flex"},children:(0,I.jsx)(g.Z,{textAlign:"center",variant:"subtitle2",children:n.name})})})}),(0,I.jsx)(f.ZP,{item:!0,xs:12,md:9,lg:9,style:{alignSelf:"center",paddingLeft:10},children:(0,I.jsx)(f.ZP,{container:!0,spacing:1,children:n.settings.map((function(e,s){return(0,I.jsx)(T.Z,{options:e.options,label:String.capitalizeFirstLetter(e.id),setState:t.setState.bind(t),id:n.id+"-"+e.id,action:e})}))})})]}),(0,I.jsx)(b.Z,{style:{marginBottom:7,marginTop:14}})]},s)}))})})]})}),(0,I.jsx)(f.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,I.jsxs)(v.Z,{variant:"outlined",expanded:"room"===this.state.expanded,onChange:function(){return t.setState({expanded:"room"})},children:[(0,I.jsxs)(y.Z,{expandIcon:(0,I.jsx)(C.Z,{}),children:[(0,I.jsx)(A.Z,{style:{fontSize:"28px"}}),(0,I.jsx)(g.Z,{variant:"h6",style:{marginLeft:5},children:"Room"})]}),(0,I.jsx)(b.Z,{}),(0,I.jsx)(w.Z,{children:(0,I.jsx)(f.ZP,{container:!0,spacing:1,style:{marginTop:2},children:this.state.rooms.map((function(e,n){var s=F[e.icon];return(0,I.jsx)(f.ZP,{item:!0,xs:12,md:3,lg:2,children:(0,I.jsxs)(Z.Z,{onClick:function(){t.updateRoom(e)},variant:e.id==t.state.smartobject.room.id?"contained":"outlined",style:{padding:5,paddingTop:10,paddingBottom:10,borderColor:"white",width:"100%"},children:[(0,I.jsx)(s,{style:{color:"white"}}),(0,I.jsx)(g.Z,{variant:"body1",style:{marginLeft:10,color:"white"},children:e.name})]})},n)}))})})]})}),(0,I.jsx)(f.ZP,{item:!0,xs:12,md:12,lg:12,children:(0,I.jsxs)(v.Z,{variant:"outlined",expanded:"edit"===this.state.expanded,onChange:function(){return t.setState({expanded:"edit"})},children:[(0,I.jsxs)(y.Z,{expandIcon:(0,I.jsx)(C.Z,{}),children:[(0,I.jsx)(R.Z,{style:{fontSize:"28px"}}),(0,I.jsx)(g.Z,{variant:"h6",style:{marginLeft:5},children:"Edit"})]}),(0,I.jsx)(b.Z,{}),(0,I.jsx)(w.Z,{children:(0,I.jsx)(f.ZP,{container:!0,spacing:1,style:{marginTop:2},children:(0,I.jsx)(f.ZP,{item:!0,xs:12,md:4,lg:4,children:(0,I.jsx)(k.Z,{value:this.state.reference,color:this.state.smartobject.reference!=this.state.reference?"warning":"info",onChange:function(e){t.setState({reference:e.nativeEvent.target.value})},onBlur:function(e){t.updateReference()},style:{width:"100%",marginRight:10,marginBottom:this.props.isMobile?10:0},label:"Name",variant:"outlined"})})})})]})})]}),(0,I.jsx)(B.Z,{onClick:function(){t.delete()}}),(0,I.jsx)(S.Z,{open:this.state.modalOpen,style:{top:"25%",left:"25%"},onClose:function(){t.setState({modalOpen:!1})},children:(0,I.jsx)(j.Z,{variant:"outlined",style:{overflow:"auto",maxHeight:"50vh",maxWidth:"50vw",padding:20},children:(0,I.jsx)(u(),{style:{fontSize:12},id:"json-pretty",data:this.state.content})})})]})]})}}]),n}(h.Component);e.default=O}}]);
//# sourceMappingURL=877.eab95253.chunk.js.map