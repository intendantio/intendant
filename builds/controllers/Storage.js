"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Controller=_interopRequireDefault(require("./Controller")),_package=_interopRequireDefault(require("../package.json")),_Tracing=_interopRequireDefault(require("../utils/Tracing")),_StackTrace=_interopRequireDefault(require("../utils/StackTrace")),_Result=_interopRequireDefault(require("../utils/Result"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Storage extends _Controller.default{async getItem(a){try{let b=await this.sqlStorage.getOneByField({id:a});return b.error?b:new _Result.default(_package.default.name,!1,"",b.data?JSON.parse(b.data.value):b.data)}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when get item in storage"),new _Result.default(_package.default.name,!0,"Error occurred when get item in storage")}}async setItem(a,b){try{let c=await this.sqlStorage.getOneByField({id:a});if(c.error)return c;if(c.data){let b=await this.removeItem(a);if(b.error)return b}let d=await this.sqlStorage.insert({id:a,value:JSON.stringify(b)});return d.error?d:new _Result.default(_package.default.name,!1,"")}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when set item in storage"),new _Result.default(_package.default.name,!0,"Error occurred when set item in storage")}}async removeItem(a){try{let b=await this.sqlStorage.deleteAllByField({id:a});return b.error?b:new _Result.default(_package.default.name,!1,"")}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when remove item in storage"),new _Result.default(_package.default.name,!0,"Error occurred when remove item in storage")}}async clear(){try{let a=await this.sqlStorage.truncate();return a.error?a:new _Result.default(_package.default.name,!1,"")}catch(a){return _StackTrace.default.save(a),_Tracing.default.error(_package.default.name,"Error occurred when clear storage"),new _Result.default(_package.default.name,!0,"Error occurred when clear storage")}}}var _default=Storage;exports.default=_default,module.exports=exports.default;