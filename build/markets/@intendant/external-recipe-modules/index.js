"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _package=_interopRequireDefault(require("./package.json")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_matchAll=_interopRequireDefault(require("match-all"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class ExternalRecipe{constructor(a){this.core=a,this.configuration="https://www.marmiton.org/recettes/recherche.aspx?aqt="}/*
        Action
    */async __getRecipe(a={}){try{if(a.recipe){let b=await this.core.controller.cache.get({reference:_package.default.name+"-"+a.recipe});if(b.error)return b;if(b.cache)return this.core.logger.verbose(_package.default.name,"Use cache"),{error:!1,code:"ok",message:b.message,data:b.data,source:"cache://www.marmiton.org"};let c=await(0,_nodeFetch.default)(this.configuration+a.recipe);if(200===c.status){let b=await c.text(),d=(0,_matchAll.default)(b,/(<script id="__NEXT_DATA__" type="application\/json">(((.|[\r\n])*?)<\/script>))/ig),e=d.toArray()[0].replace("</script>","").replace("<script id=\"__NEXT_DATA__\" type=\"application/json\">",""),f=JSON.parse(e).props.pageProps.searchResults.hits;return await this.core.controller.cache.insert({reference:_package.default.name+"-"+a.recipe,data:f,interval:2592e3}),{error:!1,code:"ok",data:f,message:"",source:"https://www.marmiton.org"}}return this.core.logger.warning(_package.default.name,"Invalid status"),{error:!0,code:_package.default.name+">getRecipe>code>invalidStatus>"+c.status,message:"Invalid status "+c.status}}return this.core.logger.warning(_package.default.name,"Recipe is missing"),{error:!0,code:_package.default.name+">getRecipe>recipe>missing",message:"Recipe is missing"}}catch(a){return this.core.logger.warning(_package.default.name,"Throw exception"),{error:!0,code:_package.default.name+">getRecipe>throwException",message:"Throw exception"}}}}var _default=ExternalRecipe;exports.default=_default,module.exports=exports.default;