"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Controller=_interopRequireDefault(require("./Controller")),_package=_interopRequireDefault(require("../package.json")),_nodeFetch=_interopRequireDefault(require("node-fetch"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Client extends _Controller.default{async insert(a={}){try{if(this.core.logger.verbose(_package.default.name,"Insert client ["+a.imei+"]"),a.imei){if(a.name){if(a.token){if(a.user){let b=await this.sqlClient.getOneByField({imei:a.imei});if(b.error)return b;if(b.data){let a=await this.sqlClient.deleteOne(b.data.id);if(a.error)return a}let c=await this.sqlClient.insert({id:null,imei:a.imei,name:a.name,token:a.token,user:a.user,lastupdate:"DATE:NOW"});return c.error?c:{error:!1,package:_package.default.name,message:""}}return{error:!0,package:_package.default.name,message:"User is missing"}}return{error:!0,package:_package.default.name,message:"Token is missing"}}return{error:!0,package:_package.default.name,message:"Name is missing"}}return{error:!0,package:_package.default.name,message:"Imei is missing"}}catch(a){return this.core.logger.error("Client : "+a.toString()),{package:_package.default.name,error:!0,message:"Internal server error"}}}async notify(a,b){try{let c=await this.sqlClient.getAll();if(c.error)return c;let d=[];c.data.forEach(c=>{""!==c.token&&d.push({to:c.token,title:"intendant - "+a,body:b})}),await(0,_nodeFetch.default)("https://exp.host/--/api/v2/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})}catch(a){return this.core.logger.error("Client : "+a.toString()),{package:_package.default.name,error:!0,message:"Internal server error"}}}}var _default=Client;exports.default=_default,module.exports=exports.default;