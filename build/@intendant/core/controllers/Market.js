"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Controller=_interopRequireDefault(require("./Controller")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_extractZip=_interopRequireDefault(require("extract-zip")),_fs=_interopRequireDefault(require("fs")),_npm=_interopRequireDefault(require("npm")),_package=_interopRequireDefault(require("../package.json")),_child_process=require("child_process");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Market extends _Controller.default{async install(a){let b=await(0,_nodeFetch.default)("https://market.intendant.io"),c=await b.json();if(c=c.filter(b=>b.name==a),0==c.length)return this.core.logger.warning(_package.default.name,"Package not found"),{package:_package.default.name,message:"",error:!0};if(1<c.length)return this.core.logger.warning(_package.default.name,"Package not found"),{package:_package.default.name,message:"",error:!0};else{this.core.logger.verbose(_package.default.name,"Find package "+a);let b=c[0];return this.core.logger.verbose(_package.default.name,"Start download package "+a),await new Promise(a=>{(0,_child_process.exec)("npm install "+b.raw+" --silent 2>&1 | tee t",()=>{a()})}),this.core.logger.verbose(_package.default.name,"Restart configuration"),a.includes("smartobject")?(this.core.manager.smartobject.installSmartobjects.push(a),await this.core.manager.smartobject.restart()):a.includes("module")&&(this.core.manager.module.installModules.push(a),this.core.manager.module.restart()),{package:_package.default.name,message:"",error:!1}}}async uninstall(a){return this.core.logger.verbose(_package.default.name,"Delete Package "+a),this.core.logger.verbose(_package.default.name,"Restart configuration"),this.core.manager.module.installModules=this.core.manager.module.installModules.filter(b=>a!=b),this.core.manager.smartobject.installSmartobjects=this.core.manager.smartobject.installSmartobjects.filter(b=>a!=b),this.core.manager.module.restart(),await this.core.manager.smartobject.restart(),{package:_package.default.name,message:"",error:!1}}}var _default=Market;exports.default=_default,module.exports=exports.default;