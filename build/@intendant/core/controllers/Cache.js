"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Controller=_interopRequireDefault(require("./Controller")),_package=_interopRequireDefault(require("../package.json"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Cache extends _Controller.default{async get(a){try{await this.check();let b=await this.sqlCache.getOneByField({reference:a.reference});return b.error?b:b.data?(this.core.logger.verbose(_package.default.name,"Find cache "+a.reference),{error:!1,message:"",cache:!0,data:JSON.parse(Buffer.from(b.data.value,"base64").toString("utf-8")).cache,package:_package.default.name}):{error:!1,message:"",cache:!1,data:!1,package:_package.default.name}}catch(a){return this.core.logger.error("Cache : "+a.toString()),{package:_package.default.name,error:!0,message:"Internal server error"}}}async insert(a){try{await this.check();let b=await this.sqlCache.getOneByField({reference:a.reference});if(b.error)return b;if(!1==b.data){let b=Buffer.from(JSON.stringify({cache:a.data})).toString("base64");return await this.sqlCache.insert({id:null,reference:a.reference,value:b,expiry:"DATE:CUSTOM"+a.interval})}}catch(a){return this.core.logger.error("Cache : "+a.toString()),{package:_package.default.name,error:!0,message:"Internal server error"}}}async check(){try{let a=await this.sqlCache.execute("DELETE FROM cache WHERE expiry < datetime('now')");return a.error?a:{error:!1,message:"",package:_package.default.name}}catch(a){return this.core.logger.error("Cache : "+a.toString()),{package:_package.default.name,error:!0,message:"Internal server error"}}}}var _default=Cache;exports.default=_default,module.exports=exports.default;