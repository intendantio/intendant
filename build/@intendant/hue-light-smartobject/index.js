"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _smartobject=_interopRequireDefault(require("@intendant/smartobject")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_package=_interopRequireDefault(require("./package.json")),_https=_interopRequireDefault(require("https")),_color=_interopRequireDefault(require("./lib/color"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}const httpsAgent=new _https.default.Agent({rejectUnauthorized:!1});class Light extends _smartobject.default{constructor(a,b,c){super(a,b,c,_package.default)}getHueSettings(){return this.core.manager.smartobject.smartobjects.has(parseInt(this.settings.hueBridge))?{error:!1,package:_package.default.name,data:this.core.manager.smartobject.smartobjects.get(parseInt(this.settings.hueBridge)).settings,message:""}:{error:!0,package:_package.default.name,message:"Missing smartobject instance "+this.settings.hueBridge}}/*
        Action
    */async __turnOn(a={}){let b=this.getHueSettings();if(b.error)return b;let c=a.color?_color.default.isHexColor(a.color.slice(1,1/0))?a.color:"#ffffff":"#ffffff",d=_color.default.hexToLab(c);a.duration==null&&(a.duration=200),a.brightness==null&&(a.brightness=70);let e={on:{on:!0},dimming:{brightness:parseInt(a.brightness)},color:{xy:{x:d.x,y:d.y}},dynamics:{duration:parseInt(a.duration)}},f=await(0,_nodeFetch.default)("https://"+b.data.path+"/clip/v2/resource/light/"+this.settings.id,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json","hue-application-key":b.data.apikey},agent:httpsAgent,body:JSON.stringify(e)});if(200==f.status){let a=await f.json();return 0<a.errors.length?{error:!0,package:_package.default.name,message:"Invalid request "+JSON.stringify(a.errors)}:{error:!1,package:_package.default.name,message:"",data:a.data[0]}}return{error:!0,package:_package.default.name,message:"Invalid status "+f.status}}async __turnOff(a={}){let b=this.getHueSettings();if(b.error)return b;a.duration==null&&(a.duration=200);let c={on:{on:!1},dynamics:{duration:parseInt(a.duration)}},d=await(0,_nodeFetch.default)("https://"+b.data.path+"/clip/v2/resource/light/"+this.settings.id,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json","hue-application-key":b.data.apikey},agent:httpsAgent,body:JSON.stringify(c)});if(200==d.status){let a=await d.json();return 0<a.errors.length?{error:!0,package:_package.default.name,message:"Invalid request "+JSON.stringify(a.errors)}:{error:!1,package:_package.default.name,message:"",data:a.data[0]}}return{error:!0,package:_package.default.name,message:"Invalid status "+d.status}}async __state(a={}){let b=this.getHueSettings();if(b.error)return b;let c=await(0,_nodeFetch.default)("https://"+b.data.path+"/clip/v2/resource/light/"+this.settings.id,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","hue-application-key":b.data.apikey},agent:httpsAgent});if(200==c.status){let a=await c.json();return 0<a.errors.length?{error:!0,package:_package.default.name,message:"Invalid request "+JSON.stringify(a.errors)}:{error:!1,package:_package.default.name,message:"",data:a.data[0]}}return{error:!0,package:_package.default.name,message:"Invalid status "+c.status}}}var _default=Light;exports.default=_default,module.exports=exports.default;