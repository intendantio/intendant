"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _smartobject=_interopRequireDefault(require("@intendant/smartobject")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_package=_interopRequireDefault(require("./package.json")),_color=_interopRequireDefault(require("./lib/color"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Light extends _smartobject.default{constructor(a,b,c){super(a,b,c,_package.default)}/*
        Action
    */async __turnOn(a={}){let c=a.color?_color.default.isHexColor(a.color.slice(1,1/0))?a.color:"#ffffff":"#ffffff";var d=parseInt(c.substr(1,2),16),e=parseInt(c.substr(3,2),16),f=parseInt(c.substr(5,2),16);let b=_color.default.rgbToHsl(d,e,f);var g=parseInt(65535*(360*_color.default.rgbToHsl(d,e,f)[0])/360);let h=parseInt(255*b[1]),i=parseInt(255*b[2]),j=await(0,_nodeFetch.default)("http://"+this.settings.path+"/api/"+this.settings.apikey+"/lights/"+this.settings.id+"/state",{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({on:!0,hue:g,sat:h,transitiontime:a.transitiontime?10*a.transitiontime:40,bri:parseInt(a.brightness?a.brightness:i)})});if(200==j.status){let a=await j.json(),b={error:!1,type:"",description:""};if(Array.isArray(a))for(let c,d=0;d<a.length;d++)c=a[d],c.error&&(b={error:!0,type:c.error.type,message:c.error.description});return b.error?{error:!0,package:_package.default.name,message:"Invalid request "+b.message}:{error:!1,package:_package.default.name,message:"",data:a}}return{error:!0,package:_package.default.name,message:"Invalid status "+j.status}}async __turnOff(a={}){let b=await(0,_nodeFetch.default)("http://"+this.settings.path+"/api/"+this.settings.apikey+"/lights/"+this.settings.id+"/state",{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({on:!1})});if(200==b.status){let a=await b.json(),c={error:!1,type:"",message:""};if(Array.isArray(a))for(let b,d=0;d<a.length;d++)b=a[d],b.error&&(c={error:!0,type:b.error.type,message:b.error.description});return c.error?{error:!0,package:_package.default.name,message:"Invalid request "+c.message}:{error:!1,package:_package.default.name,message:"",data:a}}return{error:!0,package:_package.default.name,message:"Invalid status "+b.status}}async request(){let a=await(0,_nodeFetch.default)("http://"+this.settings.path+"/api/"+this.settings.apikey+"/lights/"+this.settings.id);if(200==a.status){let b=await a.json();if(Array.isArray(b)){let a=b[0].error;return{error:!0,package:_package.default.name,message:"Invalid request "+a}}return{error:!1,package:_package.default.name,message:"",data:b}}return{error:!0,package:_package.default.name,message:"Invalid status "+a.status}}async __configuration(a={}){return await this.request()}async __state(a={}){let b=await this.request();return b.error?b:{error:!1,package:_package.default.name,message:"",data:{on:b.data.state.on,brightness:b.data.state.bri,color:b.data.state.hue,staturation:b.data.state.sat}}}}var _default=Light;exports.default=_default,module.exports=exports.default;