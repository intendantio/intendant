"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _package=_interopRequireDefault(require("./package.json")),_nodeFetch=_interopRequireDefault(require("node-fetch"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class ExternalWeather{constructor(a){this.core=a,this.configuration="https://www.prevision-meteo.ch/services/json/"}async __getWeather(a={}){try{if(a.city){let b=await this.core.controller.cache.get({reference:_package.default.name+"-"+a.city});if(b.error)return b;if(b.cache)return this.core.logger.verbose(_package.default.name,"Use cache"),{error:!1,package:_package.default.name,message:"",data:b.data,source:"cache://www.prevision-meteo.ch"};let c=await(0,_nodeFetch.default)(this.configuration+a.city);if(200===c.status){let a=await c.json();return a.errors?{error:!0,package:_package.default.name,message:"Invalid result code '"+a.errors[0].text+"'",data:{}}:(await this.core.controller.cache.insert({reference:_package.default.name,data:a,interval:600}),{error:!1,package:_package.default.name,message:"",data:a,source:"https://www.prevision-meteo.ch"})}return this.core.logger.warning(_package.default.name,"Invalid result status '"+c.status+"'"),{error:!0,package:_package.default.name,message:"Invalid status "+c.status}}return this.core.logger.warning(_package.default.name,"City is missing"),{error:!0,package:_package.default.name,message:"City is missing"}}catch(a){return this.core.logger.warning(_package.default.name,"Throw exception"),{error:!0,package:_package.default.name,message:"Throw exception"}}}}var _default=ExternalWeather;exports.default=_default,module.exports=exports.default;