"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _smartobject=_interopRequireDefault(require("@intendant/smartobject")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_formData=_interopRequireDefault(require("form-data")),_package=_interopRequireDefault(require("./package.json"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class NetatmoHomeCoach extends _smartobject.default{constructor(a,b,c){super(a,b,c,_package.default)}async request(){let a=await this.core.controller.cache.get({reference:_package.default.name+"-"+this.settings.clientId});if(a.error)return{error:!0,package:_package.default.name,message:a.message};if(a.cache)return{error:!1,package:_package.default.name,data:a.data,message:""};let b=new _formData.default;b.append("grant_type","refresh_token"),b.append("refresh_token",this.settings.token),b.append("client_id",this.settings.clientId),b.append("client_secret",this.settings.clientSecret);let c=await(0,_nodeFetch.default)("https://api.netatmo.com/oauth2/token",{body:b,method:"POST"}),d=await c.json();if(200===c.status){let a=d.access_token,b=await(0,_nodeFetch.default)("https://api.netatmo.com/api/gethomecoachsdata?device_id="+this.settings.device,{headers:{Authorization:"Bearer "+a}}),c=await b.json();return"ok"===c.status?(await this.core.controller.cache.insert({reference:_package.default.name,data:c,interval:3600}),{error:!1,package:_package.default.name,message:"",data:c}):{error:!0,package:_package.default.name,message:"Invalid request "+c.error.message}}return{error:!0,package:_package.default.name,message:"Invalid status "+c.status}}/*
        Action
    */async __dashboard(a={}){let b=await this.request();if(b.error)return b;let c=!1;if(b.data.body.devices.forEach(a=>{a._id==this.settings.device&&(c=a)}),c){let a=c.dashboard_data;return{error:!1,package:_package.default.name,message:"",data:{temperature:a.Temperature,co2:a.CO2,noise:a.Noise,pressure:a.Pressure,humidity:a.Humidity}}}return{error:!0,package:_package.default.name,message:"Device "+this.settings.device+" not found"}}async __place(a={}){let b=await this.request();if(b.error)return b;let c=!1;if(b.data.body.devices.forEach(a=>{a._id==this.settings.device&&(c=a)}),c){let a=c.place;return{error:!1,package:_package.default.name,message:"",data:{altitude:a.altitude,city:a.city,country:a.country,timezone:a.timezone,location:a.location}}}return{error:!0,package:_package.default.name,message:"Device "+this.settings.device+" not found"}}async __configuration(a={}){return await this.request()}}var _default=NetatmoHomeCoach;exports.default=_default,module.exports=exports.default;