"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _smartobject=_interopRequireDefault(require("@intendant/smartobject")),_nodeFetch=_interopRequireDefault(require("node-fetch")),_formData=_interopRequireDefault(require("form-data")),_package=_interopRequireDefault(require("./package.json"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class NetatmoHomeCoach extends _smartobject.default{constructor(a,b,c){let d=require("./configuration.json");super(a,b,c,d)}/*
        Action
    */async __getData(a={}){let b=await this.core.controller.cache.get({reference:_package.default.name+"-"+this.settings.clientId});if(b.error)return{error:!0,code:_package.default.name+">getData>"+b.code,message:b.message};if(b.cache)return{error:!1,code:"ok",data:b.data,message:""};let c=new _formData.default;c.append("grant_type","refresh_token"),c.append("refresh_token",this.settings.token),c.append("client_id",this.settings.clientId),c.append("client_secret",this.settings.clientSecret);let d=await(0,_nodeFetch.default)("https://api.netatmo.com/oauth2/token",{body:c,method:"POST"}),e=await d.json();if(200===d.status){let a=e.access_token,b=await(0,_nodeFetch.default)("https://api.netatmo.com/api/gethomecoachsdata?device_id="+this.settings.device,{headers:{Authorization:"Bearer "+a}}),c=await b.json();return"ok"===c.status?(await this.core.controller.cache.insert({reference:_package.default.name+"-"+this.settings.clientId,data:c,interval:3600}),{error:!1,code:"ok",message:"",data:c}):{error:!0,code:_package.default.name+">getData>invalidRequest>"+c.status,message:"Invalid request "+c.error.message}}return{error:!0,code:_package.default.name+">getData>invalidStatus>"+d.status,message:"Invalid status "+d.status}}}var _default=NetatmoHomeCoach;exports.default=_default,module.exports=exports.default;